#!/usr/bin/env bash

[[ ! -e alienpy/alien.py ]] && { echo "alien.py was not found"; exit 1; }

./update_version
git commit -m "alien.py update version info" alienpy/alien.py alienpy/version.py
git push
git push xjalienfs master

VER=$(python3 -c 'from alienpy.version import *;print(ALIENPY_VERSION_STR)') # '
[[ -z ${VER} ]] && { echo "Something is wrong, could not get the version number"; exit 1; }

git tag ${VER}
git push --tags
git push --tags xjalienfs master

#tag=$(git describe --tags --abbrev=0 --exact-match)

mkdir -p dist
#rm -rf dist/*
python3 -m build --sdist --wheel

echo "# Now, for pypi publishing one can do either:
twine upload --verbose dist/*
# or for testing pypi
twine upload --repository testpypi --verbose dist/*"

